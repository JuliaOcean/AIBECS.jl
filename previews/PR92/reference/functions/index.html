<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>AIBECS functions · AIBECS.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="AIBECS.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AIBECS.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/1_ideal_age/">Ideal age</a></li><li><a class="tocitem" href="../../tutorials/2_radiocarbon/">Radiocarbon</a></li><li><a class="tocitem" href="../../tutorials/3_Pmodel/">A coupled PO₄–POP model</a></li><li><a class="tocitem" href="../../tutorials/4_dustmodel/">A dust model</a></li><li><a class="tocitem" href="../../tutorials/5_river_discharge/">River discharge</a></li><li><a class="tocitem" href="../../tutorials/6_groundwater_discharge/">Groundwater discharge</a></li></ul></li><li><span class="tocitem">How-to guides</span><ul><li><a class="tocitem" href="../../howtos/1_parameters/">Parameters guide</a></li><li><a class="tocitem" href="../../howtos/2_plot/">Plot basic things</a></li><li><a class="tocitem" href="../../howtos/3_cruiseplot/">Plot transect/cruise data</a></li><li><a class="tocitem" href="../../howtos/4_fluxes/">Estimate fluxes</a></li></ul></li><li><span class="tocitem">Explanation</span><ul><li><a class="tocitem" href="../../explanation/1_concept/">Concept</a></li><li><a class="tocitem" href="../../explanation/2_tracer_transport_operators/">Tracer transport</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li class="is-active"><a class="tocitem" href>AIBECS functions</a><ul class="internal"><li><a class="tocitem" href="#Circulations"><span>Circulations</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li><li><a class="tocitem" href="#Parameters"><span>Parameters</span></a></li><li><a class="tocitem" href="#For-simulations"><span>For simulations</span></a></li><li><a class="tocitem" href="#For-particles"><span>For particles</span></a></li><li><a class="tocitem" href="#For-optimization"><span>For optimization</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>AIBECS functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>AIBECS functions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaOcean/AIBECS.jl/blob/master/docs/src/reference/functions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="AIBECS-functions"><a class="docs-heading-anchor" href="#AIBECS-functions">AIBECS functions</a><a id="AIBECS-functions-1"></a><a class="docs-heading-anchor-permalink" href="#AIBECS-functions" title="Permalink"></a></h1><h2 id="Circulations"><a class="docs-heading-anchor" href="#Circulations">Circulations</a><a id="Circulations-1"></a><a class="docs-heading-anchor-permalink" href="#Circulations" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="AIBECS.OCIM2.load" href="#AIBECS.OCIM2.load"><code>AIBECS.OCIM2.load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load</code></pre><p>Returns the grid, the transport matrix, and the He fluxes (in that order).</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>To load the default OCIM2 matrix and grid, do</p><pre><code class="nohighlight hljs">julia&gt; grd, T = OCIM2.load()</code></pre><p>But you can also load the other matrices by specifying which version you want, e.g.,</p><pre><code class="nohighlight hljs">julia&gt; grd, T = OCIM2.load(version=&quot;KiHIGH_noHe&quot;)</code></pre><p>Add the <code>HeFluxes=true</code> keyword argument if you want the OCIM-produced He fields with ³He and ⁴He as 3rd and 4th arguments. (3rd and 4th output are returned as <code>nothing</code> for &quot;noHe&quot; versions).</p><p>See <em>DeVries and Holzer</em> (2019) for more details.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/OCIM2.jl#L95-L115">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.OCIM1.load" href="#AIBECS.OCIM1.load"><code>AIBECS.OCIM1.load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load</code></pre><p>Returns the grid and the transport matrix (in that order).</p><p><strong>Usage</strong></p><pre><code class="nohighlight hljs">julia&gt; grd, T = OCIM1.load()</code></pre><p>See <em>DeVries and Primeau</em> (2011) and <em>DeVries</em> (2014) for more details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/OCIM1.jl#L62-L74">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.OCIM0.load" href="#AIBECS.OCIM0.load"><code>AIBECS.OCIM0.load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load</code></pre><p>Returns the grid and the transport matrix (in that order).</p><p><strong>Usage</strong></p><pre><code class="nohighlight hljs">julia&gt; grd, T = OCIM0.load()</code></pre><p>See <em>DeVries and Primeau</em> (2011) and <em>Primeau et al.</em> (2013) for more details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/OCIM0.jl#L52-L64">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.OCCA.load" href="#AIBECS.OCCA.load"><code>AIBECS.OCCA.load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load</code></pre><p>Returns the grid and the transport matrix.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>To load the OCCA matrix and grid, do</p><pre><code class="nohighlight hljs">julia&gt; grd, T = OCCA.load()</code></pre><p>See <em>Forget</em> (2010) for more details</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/OCCA.jl#L70-L81">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.Primeau_2x2x2.load" href="#AIBECS.Primeau_2x2x2.load"><code>AIBECS.Primeau_2x2x2.load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load</code></pre><p>Returns <code>grd</code> and <code>T</code> (in that order).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/Primeau_2x2x2.jl#L57-L61">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.Archer_etal_2000.load" href="#AIBECS.Archer_etal_2000.load"><code>AIBECS.Archer_etal_2000.load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load</code></pre><p>Returns <code>grd</code> and <code>T</code> (in that order).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/Archer_etal_2000.jl#L76-L80">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.TwoBoxModel.load" href="#AIBECS.TwoBoxModel.load"><code>AIBECS.TwoBoxModel.load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load</code></pre><p>Returns <code>grd</code> and <code>T</code> (in that order).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/TwoBoxModel.jl#L53-L57">source</a></section></article><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plothorizontalslice" href="#AIBECS.plothorizontalslice"><code>AIBECS.plothorizontalslice</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plothorizontalslice(x, grd; depth)</code></pre><p>Plots a heatmap of the horizontal slice of tracer <code>x</code> at depth <code>depth</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L28-L32">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.surfacemap" href="#AIBECS.surfacemap"><code>AIBECS.surfacemap</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">surfacemap(x, grd)</code></pre><p>Plots a surface heatmap of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L36-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plot∫dz" href="#AIBECS.plot∫dz"><code>AIBECS.plot∫dz</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotverticalintegral(x, grd, mask=1)</code></pre><p>Plots the vertical integral of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L43-L47">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plotverticalmean" href="#AIBECS.plotverticalmean"><code>AIBECS.plotverticalmean</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotverticalaverage(x, grd, mask=1)</code></pre><p>Plots the vertical average of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L52-L56">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.minimap" href="#AIBECS.minimap"><code>AIBECS.minimap</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">minimap(grd; central_longitude=200°)</code></pre><p>Plots a surface map of grd with no ticks, labels, or colorbar.</p><p>The goal of this function is to provide a way to plot both a minimap and a cruise track when plotting a transect:</p><pre><code class="nohighlight hljs">plottransect(dummy, grd; ct=sort(ct))
plot!(inset_subplots=bbox(0.73,0.73,0.15,0.15), subplot=2)
minimap!(grd; subplot=2)
plotcruisetrack!(sort(ct), subplot=2)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L61-L74">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plotmeridionalslice" href="#AIBECS.plotmeridionalslice"><code>AIBECS.plotmeridionalslice</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotmeridionalslice(x, grd; lon)</code></pre><p>Plots a meridional slice of tracer <code>x</code> at longitude <code>lon</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L114-L118">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plotzonalmean" href="#AIBECS.plotzonalmean"><code>AIBECS.plotzonalmean</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotzonalmean(x, grd; mask=1)</code></pre><p>Plots a zonal average of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L123-L127">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plot∫dx" href="#AIBECS.plot∫dx"><code>AIBECS.plot∫dx</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotzonalintegral(x, grd; mask=1)</code></pre><p>Plots a zonal integral of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L133-L137">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plotzonalslice" href="#AIBECS.plotzonalslice"><code>AIBECS.plotzonalslice</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotzonalslice(x, grd; lat)</code></pre><p>Plots a zonal slice of tracer <code>x</code> at latitude <code>lat</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L158-L162">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plotmeridionalmean" href="#AIBECS.plotmeridionalmean"><code>AIBECS.plotmeridionalmean</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotmeridionalmean(x, grd; mask=1)</code></pre><p>Plots a meridional average of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L164-L168">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plot∫dy" href="#AIBECS.plot∫dy"><code>AIBECS.plot∫dy</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotmeridionalintegral(x, grd; mask=1)</code></pre><p>Plots a meridional integral of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L171-L175">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plot∫dxdy" href="#AIBECS.plot∫dxdy"><code>AIBECS.plot∫dxdy</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">horizontalintegral(x, grd; mask=1)</code></pre><p>Plots a horizontal integral of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L195-L199">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plothorizontalmean" href="#AIBECS.plothorizontalmean"><code>AIBECS.plothorizontalmean</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plothorizontalaverage(x, grd; mask=1)</code></pre><p>Plots a horizontal average of tracer <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L205-L209">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plotdepthprofile" href="#AIBECS.plotdepthprofile"><code>AIBECS.plotdepthprofile</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plotdepthprofile(x, grd; lonlat)</code></pre><p>Plots the profile of tracer <code>x</code> interpolated at <code>lonlat=(x,y)</code> coordinates.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L215-L219">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plottransect" href="#AIBECS.plottransect"><code>AIBECS.plottransect</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plottransect(x, grd; ct=ct)</code></pre><p>Plots the transect of tracer <code>x</code> along transect <code>ct</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L238-L242">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.ratioatstation" href="#AIBECS.ratioatstation"><code>AIBECS.ratioatstation</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">RatioAtStation(x, y, grd, station, depthlims=(0,Inf))</code></pre><p>Plots a meridional transect of tracer <code>x</code> along cruise track <code>ct</code>.</p><p>The keyword argument <code>zlims=(ztop, zbottom)</code> can be provided if you only want to only plot for depths <code>z ∈ (ztop, zbottom)</code>. (<code>z</code> is positive downwards in this case)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L249-L257">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plotparameter" href="#AIBECS.plotparameter"><code>AIBECS.plotparameter</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">PlotParameter(p::AbstractParameters, s)</code></pre><p>Plots the PDF of parameter <code>p</code> with symbol <code>s</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L287-L291">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.plotparameters" href="#AIBECS.plotparameters"><code>AIBECS.plotparameters</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">PlotParameters(p::AbstractParameters)</code></pre><p>Plots the PDF of all the flattenable parameters in <code>p</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/plot_recipes.jl#L316-L320">source</a></section></article><h2 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="AIBECS.AbstractParameters" href="#AIBECS.AbstractParameters"><code>AIBECS.AbstractParameters</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractParameters{T} &lt;: AbstractVector{T}</code></pre><p>An abstract type for AIBECS model parameters.</p><p>Parameters in AIBECS use the following convenience packages:</p><ul><li>Parameters</li><li>FieldMetadata</li><li>FieldDefaults</li><li>Flatten</li><li>Unitful</li><li>DataFrames</li><li>Distributions</li></ul><p>These aim to allow for some nice features, which include</p><ul><li>nice syntax for unpacking parameters in functions via the <code>@unpack</code> macro (fron UnPack.jl)</li><li>additional metadata on parameters</li><li>easy conversion to and from vectors</li><li>use of units and automatic conversions if necessary</li><li>pretty table-format displays</li><li>loading and saving to and from CSV files</li><li>prior estimates for bayesian inference and optimization</li></ul><p>See the list of examples to get an idea of how to generate parameters for your model.</p><p><strong>Examples</strong></p><p>Generate a simple parameter type via</p><pre><code class="language-julia-repl hljs">julia&gt; struct SimpleParams{T} &lt;: AbstractParameters{T}
           α::T
           β::T
           γ::T
       end
SimpleParams</code></pre><p>To create an instance of the <code>SimpleParams(Float64)</code> type, you can do</p><pre><code class="language-julia-repl hljs">julia&gt; p = SimpleParams(1.0, 2.0, 3.0)
SimpleParams{Float64}
│ Row │ Symbol │ Value   │
│     │ Symbol │ Float64 │
├─────┼────────┼─────────┤
│ 1   │ α      │ 1.0     │
│ 2   │ β      │ 2.0     │
│ 3   │ γ      │ 3.0     │</code></pre><p>One of the core features from Parameters is unpacking in functions, e.g.,</p><pre><code class="language-julia-repl hljs">julia&gt; function simplef(p)
           @unpack α, γ = p
           return α + γ
       end
simplef (generic function with 1 method)

julia&gt; simplef(p) # 1.0 + 3.0
4.0</code></pre><p>More complex examples are permitted by adding metadata (thanks to FieldMetadata.jl). You can add units</p><pre><code class="language-julia-repl hljs">julia&gt; @units struct UnitParams{T} &lt;: AbstractParameters{T}
           α::T | u&quot;km&quot;
           β::T | u&quot;hr&quot;
           γ::T | u&quot;m/s&quot;
       end ;

julia&gt; p = UnitParams(1.0, 2.0, 3.0)
UnitParams{Float64}
│ Row │ Symbol │ Value   │ Unit     │
│     │ Symbol │ Float64 │ Unitful… │
├─────┼────────┼─────────┼──────────┤
│ 1   │ α      │ 1.0     │ km       │
│ 2   │ β      │ 2.0     │ hr       │
│ 3   │ γ      │ 3.0     │ m s^-1   │</code></pre><p>Note that when adding units to your parameters, they will be converted to SI when unpacked, as in, e.g.,</p><pre><code class="language-julia-repl hljs">julia&gt; function speed(p)
           @unpack α, β, γ = p
           return α / β + γ
       end
speed (generic function with 1 method)

julia&gt; speed(p) # (1.0 km / 2.0 hr + 3 m/s) in m/s
3.138888888888889</code></pre><p>Another example for optimizable/flattenable parameters</p><pre><code class="language-julia-repl hljs">julia&gt; @initial_value @units @flattenable struct OptParams{T} &lt;: AbstractParameters{T}
           α::T | 3.6 | u&quot;km&quot;  | true
           β::T | 1.0 | u&quot;hr&quot;  | false
           γ::T | 1.0 | u&quot;m/s&quot; | true
       end ;

julia&gt; p = OptParams(initial_value(OptParams)...)
OptParams{Float64}
│ Row │ Symbol │ Value   │ Initial value │ Unit     │ Optimizable │
│     │ Symbol │ Float64 │ Float64       │ Unitful… │ Bool        │
├─────┼────────┼─────────┼───────────────┼──────────┼─────────────┤
│ 1   │ α      │ 3.6     │ 3.6           │ km       │ 1           │
│ 2   │ β      │ 1.0     │ 1.0           │ hr       │ 0           │
│ 3   │ γ      │ 1.0     │ 1.0           │ m s^-1   │ 1           │</code></pre><p>Thanks to the FieldMetaData interface, you can chain the following preloaded metadata:</p><ul><li>initial_value</li><li>units (from Unitful.jl)</li><li>prior (from Distributions.jl)</li><li>description (<code>String</code>)</li><li>bounds (2-element <code>Tuple</code>)</li><li>logscaled (<code>Bool</code>)</li><li>flattenable (to convert to vectors of optimizable parameters only)</li><li>reference (<code>String</code>)</li></ul><p>Here is an example of parameter with all the possible metadata available in AIBECS:</p><pre><code class="language-julia-repl hljs">julia&gt; @initial_value @units @prior @description @bounds @logscaled @flattenable @reference struct FullParams{T} &lt;: AbstractParameters{T}
           α::T | 1.0 | u&quot;km&quot;  | Normal(0,1)    | &quot;The distance&quot;   | (-Inf, Inf) | false | false | &quot;Jean et al., 2042&quot;
           β::T | 2.0 | u&quot;hr&quot;  | LogNormal(0,1) | &quot;The time&quot;       | (   0, Inf) | true  | true  | &quot;Claude et al. 1983&quot;
           γ::T | 3.0 | u&quot;mol&quot; | Normal(1,2)    | &quot;The # of moles&quot; | (  -1,   1) | false | true  | &quot;Dusse et al. 2000&quot;
       end ;

julia&gt; FullParams(4.0, 5.0, 6.0)
FullParams{Float64}
│ Row │ Symbol │ Value   │ Initial value │ Unit     │ Prior                            │ Description    │ Bounds      │ Logscaled │ Optimizable │ Reference          │
│     │ Symbol │ Float64 │ Float64       │ Unitful… │ Distribu…                        │ String         │ Tuple…      │ Bool      │ Bool        │ String             │
├─────┼────────┼─────────┼───────────────┼──────────┼──────────────────────────────────┼────────────────┼─────────────┼───────────┼─────────────┼────────────────────┤
│ 1   │ α      │ 4.0     │ 1.0           │ km       │ Normal{Float64}(μ=0.0, σ=1.0)    │ The distance   │ (-Inf, Inf) │ 0         │ 0           │ Jean et al., 2042  │
│ 2   │ β      │ 5.0     │ 2.0           │ hr       │ LogNormal{Float64}(μ=0.0, σ=1.0) │ The time       │ (0, Inf)    │ 1         │ 1           │ Claude et al. 1983 │
│ 3   │ γ      │ 6.0     │ 3.0           │ mol      │ Normal{Float64}(μ=1.0, σ=2.0)    │ The # of moles │ (-1, 1)     │ 0         │ 1           │ Dusse et al. 2000  │</code></pre><p>Note that there is no check that the metadata you give is consistent. These metadata will hopefully be useful for advanced usage of AIBECS, e.g., using prior information and/or bounds for optimization.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/Parameters.jl#L12-L163">source</a></section></article><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>unpack</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>length(&lt;:AbstractParameters)</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>size(&lt;:AbstractParameters)</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>values(&lt;:AbstractParameters)</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>symbols</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>flattenable_values</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>flattenable_symbols</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="AIBECS.latex" href="#AIBECS.latex"><code>AIBECS.latex</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">latex(p)</code></pre><p>Returns a LaTeX-formatted table of the parameters.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/Parameters.jl#L287-L291">source</a></section></article><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>table</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="Base.vec" href="#Base.vec"><code>Base.vec</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">vec(p::T) where {T &lt;: AbstractParameters}</code></pre><p>Returns a <strong>SI-unit-converted</strong> vector of flattenable values of <code>p</code>.</p><p>Note that <code>vec(p) ≠ flattenable_values(p)</code> if <code>p</code> has units.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/Parameters.jl#L212-L218">source</a></section></article><h2 id="For-simulations"><a class="docs-heading-anchor" href="#For-simulations">For simulations</a><a id="For-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#For-simulations" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>state_function_and_Jacobian</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="AIBECS.split_state_function_and_Jacobian" href="#AIBECS.split_state_function_and_Jacobian"><code>AIBECS.split_state_function_and_Jacobian</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">F, L, NL, ∇ₓF, ∇ₓL, ∇ₓNL, T = split_state_function_and_Jacobian(Ts, Ls, NLs, nb)</code></pre><p>Returns the state function <code>F</code> and its jacobian, <code>∇ₓF</code>, as well as a collection of split operators. This is experimental. Use at your own risk!</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/multiTracer.jl#L176-L180">source</a></section></article><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>SteadyStateProblem</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="CommonSolve.solve" href="#CommonSolve.solve"><code>CommonSolve.solve</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">solve(prob::SciMLBase.AbstractSteadyStateProblem,
      alg::CTKAlg;
      nrm=norm,
      τstop=1e12*365*24*60*60,
      preprint=&quot;&quot;,
      maxItNewton=50)</code></pre><p>Solves <code>prob</code> using the modified C.T.Kelley Shamanskii algorithm.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/overload_solve.jl#L4-L13">source</a></section></article><h2 id="For-particles"><a class="docs-heading-anchor" href="#For-particles">For particles</a><a id="For-particles-1"></a><a class="docs-heading-anchor-permalink" href="#For-particles" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="AIBECS.transportoperator" href="#AIBECS.transportoperator"><code>AIBECS.transportoperator</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">transportoperator(grd, w)</code></pre><p>Returns the transportoperator for the given settling velocity <code>w</code>.</p><p>The settling velocity can be provided as either a scalar (e.g., <code>w = 100.0</code> in units of meters per second) or as a function of depth (e.g., <code>w(z) = 2z + 1</code>).</p><p><strong>Examples</strong></p><p>Create the particle flux divergence with settling velocity of 100m/s</p><pre><code class="language-julia-repl hljs">julia&gt; T = transportoperator(grd, 100.0)</code></pre><p>Or with settling velocity function w(z) = 2z + 1</p><pre><code class="language-julia-repl hljs">julia&gt; T = transportoperator(grd, z -&gt; 2z + 1)</code></pre><p>By default, the seafloor flux is set to zero, so that all the particles that reach it are remineralized there. You can let particles go through by setting <code>fsedremin=0.0</code>, via, e.g.,</p><pre><code class="language-julia-repl hljs">julia&gt; T = transportoperator(grd, z -&gt; 2z + 1; fsedremin=0.0)</code></pre><p>For finer control and advanced use, see the particle-flux divergence operator function, <code>PFDO</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/SinkingParticles.jl#L157-L191">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.PFDO" href="#AIBECS.PFDO"><code>AIBECS.PFDO</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">PFDO(grd; w_top)</code></pre><p>Builds the particle-flux-divergence operator <code>PFDO</code> for a given particle sinking speed (<code>w_top</code>).</p><p>Schematic of a grid cell:</p><pre><code class="nohighlight hljs">     top  ┌─────────────────────────────────┐   ┬
          │      ↓ w_top          ↓ Φ_top   │   │
          │ (settling velovity)    (flux)   │   │
          │                                 │   │
          │            x                    │   δz
          │      (particle conc.)           │   │
          │                                 │   │
          │                                 │   │
  bottom  └─────────────────────────────────┘   ┴</code></pre><ul><li><code>δz</code> is the height of grid cell [m]</li><li><code>w_top</code> is the particle sinking speed at the top of the grid cell [m s⁻¹]</li><li><code>Φ_top</code> is the flux at the top of the grid cell [mol m⁻² s⁻¹]</li><li><code>x</code> is the particle concentration of the cell [mol m⁻³]</li></ul><p>The PFDO is defined by</p><pre><code class="nohighlight hljs">PFDO * x = δΦ/δz ≈ dΦ/dz,</code></pre><p>i.e., so that applied to <code>x</code> it approximates the flux divergence of <code>x</code>, dΦ/δz. It is calculated as the matrix product of DIVO and FATO:</p><pre><code class="nohighlight hljs">PFDO = DIVO * FATO.</code></pre><p>where the divergence operator <code>DIVO</code>, is defined by (<code>z</code> increasing downward)</p><pre><code class="nohighlight hljs">DIVO * ϕ_top = 1/δz * (ϕ_top[below] - ϕ_top) = δϕ/δz ≈ dΦ/δz.</code></pre><p>and FATO, the flux-at-top operator, is defined by</p><pre><code class="nohighlight hljs">FATO * x = w_top * x[above] ≈ ϕ_top.</code></pre><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; PFDO(grd, w_top=1.0) # 1.0 m/s (SI units assumed)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/SinkingParticles.jl#L9-L55">source</a></section><section><div><pre><code class="nohighlight hljs">PFDO(w, DIVO, Iabove)</code></pre><p>Returns <code>DIVO * FATO(w, Iabove)</code></p><p>This function is useful to avoid reconstructing <code>DIVO</code> and <code>Iabove</code> every time. It should allow for faster runs.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/SinkingParticles.jl#L63-L70">source</a></section><section><div><pre><code class="nohighlight hljs">PFDO(grd, δz, w_top, w_bot, frac_seafloor, cumfrac_seafloor, fsedremin, Iabove)</code></pre><p>Returns the particle-flux-divergence operator for a given sinking speed as a function of depth.</p><p>This is a slightly different construction where I take in top and bottom settling velocities, and where the bottom one can be modified to further allow a fraction of particles to sink through (buried into) the sea floor.</p><p>Below is a detailed explanation of how this function computes the particle-flux divergence. Take these 3 boxes on top of each other:</p><pre><code class="nohighlight hljs">┌──────────────────┐
│ water            │
│←----c----→       │
├───────────┲━━━━━━┥ ←- Φ_top
│           ┃⣿⣿⣿⣿⣿⣿│
│           ┃⣿⣿⣿⣿⣿⣿│
│←-d-→ ←-a-→┃⣿⣿⣿⣿⣿⣿│
├─────┲━━━━━┹──────┤ ←- Φ_bot
│     ┃←----b-----→│
│     ┃⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿│
│     ┃⣿⣿⣿ land ⣿⣿⣿│
│     ┃⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿│
└━━━━━┹────────────┘</code></pre><p>A part of each of these boxes is water, while the rest is land. For the middle box, we will use the fractional area <code>a = frac_seafloor</code> of seafloor, and the cumulated fractional area <code>b = cumfrac_seafloor</code> of seafloor, to determine the flux of particles at the top <code>ϕ_top</code> and bottom <code>ϕ_bot</code>.</p><p>From the top box, only the particles in the water can enter the middle box. So the flux at the top of the middle box, <code>ϕ_top</code>, is proportional to <code>c = 1 - Iabove * b</code>. At the bottom of the middle box, we have to take care of the case of particles hitting the sediments and potentially buried there, or kept in the water. For the part going through the area <code>d</code>, the flux is proportional to <code>d = 1 - b</code>. For the part going through <code>a</code> (hitting the sediments), the flux is proportional to <code>a * (1 - f)</code> where <code>f</code> is the fraction of particles forcibly kept in the water. (So if <code>f = 0</code>, the particles appear to move out of the middle box, but are not carried into the bottom one, and thus are removed from the system / buried.)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/SinkingParticles.jl#L73-L115">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.DIVO" href="#AIBECS.DIVO"><code>AIBECS.DIVO</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">DIVO(grd)</code></pre><p>Build the <code>DIVO</code> operator such that</p><pre><code class="nohighlight hljs">DIVO * ϕ_top = 1/δz * (ϕ_top - ϕ_top[below]) ≈ dΦ/δz.</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/SinkingParticles.jl#L126-L132">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AIBECS.FATO" href="#AIBECS.FATO"><code>AIBECS.FATO</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">FATO(w_top, Iabove)</code></pre><p>Build the <code>FATO</code> operator for a particle sinking speed <code>w_top</code></p><p>(<code>w_top</code> is the sinking speed at the top of each grid cell.)</p><p>The <code>FATO</code> operator is defined by</p><pre><code class="nohighlight hljs">FATO * x = w_top * x(above) ≈ ϕ_top.</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaOcean/AIBECS.jl/blob/d9567a5ffb2f80cacf50dce6cdc3765e395a1d84/src/SinkingParticles.jl#L140-L150">source</a></section></article><h2 id="For-optimization"><a class="docs-heading-anchor" href="#For-optimization">For optimization</a><a id="For-optimization-1"></a><a class="docs-heading-anchor-permalink" href="#For-optimization" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>mismatch</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>∇mismatch</code>. Check Documenter&#39;s build log for details.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../explanation/2_tracer_transport_operators/">« Tracer transport</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Tuesday 24 May 2022 01:39">Tuesday 24 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
